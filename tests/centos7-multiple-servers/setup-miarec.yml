# ------------------------------------------------
# Deploy MiaRec Web UI and celery task manager
# ------------------------------------------------
- name: Deploy MiaRec Web application
  hosts: 
    - web
    - celery
    - celerybeat
  vars_files:
    - ../../vars/postgresql.yml
    - ../../vars/python.yml
  become: yes
  roles:
    - role: 'miarecweb'
      tags: 'miarecweb'
      miarecweb_version: 6.0.0.370
      miarecweb_db_host: "{{ db_ip_address }}"
      miarecweb_redis_host: "{{ redis_ip_address }}"
      miarecweb_install_apache: "{{ 'web' in group_names }}"
      miarecweb_install_celeryd: "{{ 'celery' in group_names }}"
      miarecweb_install_celerybeat: "{{ 'celerybeat' in group_names }}"

    
# ------------------------------------------------
# Deploy MiaRec recorder
# ------------------------------------------------
- name: Deploy MiaRec Recorder application
  hosts: recorder
  vars_files:
    - ../../vars/postgresql.yml
  become: yes
  roles:
    - role: 'miarec'
      tags: 'miarec'
      miarec_version: 6.0.0.31
      miarec_db_host: "{{ db_ip_address }}"
      miarec_redis_host: "{{ redis_ip_address }}"
